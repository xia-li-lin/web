<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <header id="header">头部栏目</header>
    <section id="wrap">
        <ul id="list"></ul>
    </section>
    <footer id="footer">底部栏目</footer>

    <script src="./js/m.Tween.js"></script>
    <script>
        document.addEventListener('touchstart', function (e) {
            e.preventDefault();
        }, { passive: false });

        window.onload = function () {
            var html = document.documentElement;
            var htmlWidth = html.getBoundingClientRect().width;
            html.style.fontSize = htmlWidth / 16 + 'px';

            var wrap = document.querySelector('#wrap');
            var list = document.querySelector('#list');
            var scrollBar = document.createElement('div');
            createHTML(list);

            css(list, 'translateZ', 0.01);
            var startPoint = 0;
            var startEl = 0;
            var lastY = 0;
            var lastDis = 0;
            var lastTime = 0;
            var lastTimeDis = 0;
            var maxTranslate = wrap.clientHeight - list.offsetHeight;
            var scale = wrap.clientHeight / list.offsetHeight;
            scrollBar.style.cssText = `
                width:6px;
                background:rgba(0,0,0,.5);
                position:absolute;
                right:0;
                top:0;
                border-radius:3px;
                height:100px;
                opacity:0;
                transition:.3s opacity;
            `;
            wrap.appendChild(scrollBar);
            list.addEventListener('touchstart', function (e) {
                maxTranslate = wrap.clientHeight - list.offsetHeight;
                scale = wrap.clientHeight / list.offsetHeight;
                scrollBar.style.height = wrap.clientHeight * scale;
                clearInterval(this.timer);
                startPoint = e.changedTouches[0].pageY;
                startEl = css(this, 'translateY');
                lastY = startEl;
                lastDis = 0;
                lastTime = new Date().getTime();
                scrollBar.style.opacity = 1;
            });

            list.addEventListener('touchmove', function (e) {
                var nowTime = new Date().getTime();
                var nowPoint = e.changedTouches[0].pageY;
                var dis = nowPoint - startPoint;
                var translateY = startEl + dis;
                css(this, 'translateY', translateY);
                lastDis = translateY - lastY;
                lastY = translateY;
                lastTimeDis = nowTime - lastTime;
                lastTime = nowTime;
            });

            list.addEventListener('touchend', function (e) {
                var type = 'easeOut';
                var speed = Math.round(lastDis / lastTimeDis * 10);
                speed = lastTimeDis <= 0 ? 0 : speed;
                var target = Math.round(speed * 20 + css(this, 'translateY'));
                // console.log(target);
                if (target > 0) {
                    target = 0;
                    type = 'backOut';
                } else if (target < maxTranslate) {
                    target = maxTranslate;
                }
                MTween({
                    el: this,
                    target: {
                        translateY: target
                    },
                    time: Math.round(Math.abs(target - css(this, 'translateY'))) * 2,
                    type: type,
                    callBack: function () {
                        scrollBar.style.opacity = 0;
                    }
                });
            });
        };

        function createHTML(elem) {
            var html = ``;
            for (var i = 0; i < 100; i++) {
                html += `<li>这是第${i + 1}个li</li>`;
            }
            elem.innerHTML = html;
        }
    </script>
</body>

</html>